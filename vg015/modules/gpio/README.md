## Модуль `gpio`

Директория `gpio` содержит вспомогательные функции для работы с портами ввода‑вывода (GPIO) микроконтроллера К1921ВГ015.  
Цель модуля — упростить типичные операции инициализации пинов (сброс в «чистое» состояние, настройка входа/выхода, включение прерываний и фильтрации дребезга), опираясь на низкоуровневую библиотеку `plib015_gpio`.

### Файлы

- `gpio_helpers.h` — заголовок:
  - подключает типы контроллера GPIO и функции `plib015_gpio`;
  - объявляет функции:
    - `gpio_reset_pin(GPIO_TypeDef* GPIOx, uint32_t Pin)` — вернуть пин в безопасное состояние по умолчанию;
    - `gpio_init_output(GPIO_TypeDef* GPIOx, uint32_t Pin, uint8_t initial_state)` — настройка пина на вывод с заданным начальным уровнем;
    - `gpio_init_input(GPIO_TypeDef* GPIOx, uint32_t Pin, GPIO_PullMode_TypeDef pull_mode)` — настройка пина на вход с нужной подтяжкой и фильтрацией;
    - `gpio_init_input_irq(GPIO_TypeDef* GPIOx, uint32_t Pin, GPIO_PullMode_TypeDef pull_mode, volatile uint8_t* last_state)` — вход с прерыванием и запоминанием последнего состояния.

- `gpio_helpers.c` — реализация:
  - `gpio_reset_pin(...)`:
    - отключает выход и альтернативные функции;
    - сбрасывает номер альтернативной функции;
    - возвращает режимы входа/выхода и подтяжек в значения по умолчанию;
    - отключает прерывания и входной квалификатор;
  - `gpio_init_output(...)`:
    - сначала полностью сбрасывает пин через `gpio_reset_pin`;
    - инициализирует пин как обычный push‑pull выход;
    - устанавливает начальное логическое состояние (0 или 1);
  - `gpio_init_input(...)`:
    - сбрасывает пин, затем настраивает его как вход с режимом Шмитта и заданной подтяжкой;
    - включает пересинхронизацию и аппаратную фильтрацию дребезга (через входной квалификатор);
  - `gpio_init_input_irq(...)`:
    - вызывает `gpio_init_input` для базовой настройки;
    - настраивает прерывание по фронтам (по сути по любому изменению уровня);
    - очищает флаги прерывания и включает его;
    - при наличии указателя `last_state` считывает текущее состояние пина и сохраняет (используется для антидребезга в обработчике).

### Как используется в проекте

- В `main.c`:
  - функция `gpio_init()`:
    - включает тактирование порта GPIOA;
    - вызывает `gpio_init_output(GPIOA, GPIO_Pin_4..7, 0)` для четырёх светодиодов (PA4–PA7) в состоянии «выключено»;
  - функция `gpio_irq_init()`:
    - вызывает `gpio_init_input_irq(GPIOA, GPIO_Pin_0..3, GPIO_PullMode_PU, &g_btn_last_state[i])` для кнопок PA0–PA3;
    - регистрирует обработчик прерываний GPIO в PLIC.
- В обработчике `gpio_irq_handler()`:
  - используется сохранённое `g_btn_last_state[]` и глобальный счётчик `ms_ticks` для реализации простого антидребезга;
  - при подтверждённом нажатии кнопки соответствующий светодиод переключается (включается/выключается) через функции `GPIO_SetBits`/`GPIO_ClearBits`.

Таким образом, модуль `gpio` сводит большое количество однотипных низкоуровневых вызовов к нескольким понятным helper‑функциям, уменьшая вероятность ошибок при конфигурации пинов.

